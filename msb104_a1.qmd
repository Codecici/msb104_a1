---
title: "Assignment 1: Data and Descriptive, MSB104 2025"
author: Karin Liang
format: html
lang: NO_nb
editor: visual
bibliography:
---

# Introduksjon

Denne oppgaven studerer regionale økonomiske forskjeller i Belgia (BE), Nederland (NL), Bulgaria (BG) og Norge (NO). Ved å bruke Eurostat-data om BNP og befolkning beregnes BNP per innbygger for å sammenligne regioner på tvers av land og over tid.

## Del A: Subnasjonalt BNP og BNP per innbygger

Denne analysen bruker to regionale datasett fra Eurostat: GDP (nama_10r_3gdp) og papulation (demo_r_pjanaggr3).

### Datainnsamling

```{r}
# pakker
library(dplyr)
library(ggplot2)
library(stringr)
library(tidyverse)


# install datapakken "eurostat"
# install.packages("eurostat")
library(eurostat)
```

```{r}
# laster ned datasettet GDP (nama_10r_3gdp)
gdp <- get_eurostat("nama_10r_3gdp", time_format = "num")

# velger tidperiod 2000-2023, unit i MIO_EUR (Million euro), og 4 land ("BE", "NL", "BG", "NO")
gdp <- gdp %>%
  filter(unit == "MIO_EUR") %>%
  mutate(TIME_PERIOD = as.numeric(TIME_PERIOD), geo = as.character(geo)) %>%
  filter(TIME_PERIOD >= 2000, TIME_PERIOD <= 2023) %>% #velger år 2000-2023
  filter(substr(geo, 1, 2) %in% c("BE", "NL", "BG", "NO")) %>% # velger 4 land
  filter(nchar(geo) == 5)    # velger NUTS3

# viser BNP-datastruktur
glimpse(gdp)
```

#### Datastruktur for GDP

Datasettet GDP (nama_10r_3gdp) er hentet fra Eurostat og inneholder årlige verdier for BNP (bruttonasjonalprodukt) på NUTS3-nivå. Etter filtrering ifølge oppgaven består datasettet GDP av 2 591 observasjoner og 5 variabler: freq: viser frekvensen, her årlig "A" unit: måleenhet, "MIO_EUR" betyr millioner euro geo: geografisk kode "NUTS3" TIME_PERIOD: år, fra 2000 til 2023 values: BNP-verdi i millioner euro Datasettet dekker regionale BNP-data for BE (Belgia), NL (Nederland), BG (Bulgaria), NO (Norge).

```{r}
# laster ned datasettet population (demo_r_pjanaggr3)
population <- get_eurostat("demo_r_pjanaggr3", time_format = "num")

# velger tidperiod 2000-2023, age Total population (Million euro), og 4 land ("BE", "NL", "BG", "NO")
population <- population %>%
  filter(sex == "T", age == "TOTAL") %>%
  mutate(TIME_PERIOD = as.numeric(TIME_PERIOD), geo = as.character(geo)) %>%
  filter(between(TIME_PERIOD, 2000, 2023)) %>% #velger år 2000-2023
  filter(substr(geo, 1, 2) %in% c("BE", "NL", "BG", "NO")) %>% # velger 4 land
  filter(nchar(geo) == 5)    # velger NUTS3

# viser population-datastruktur
glimpse(population)
```

#### Datastruktur for population

Datasettet papulation (demo_r_pjanaggr3) er hentet fra Eurostat og viser befolkningen per 1. januar for hver NUTS3-region. Etter filtrering ifølge oppgaven består datasettet av 3 023 observasjoner og 7 variabler: unit: måleenhet, "NR" betyr antall personer sex: kjønn, her "T" for total befolkning age: "TOTAL", viser total befolkning uten aldersinndeling values: antall personer i regionen freq, geo og TIME_PERIOD har samme betydning som i GDP datasettet Datasettet dekker den totale befolkningen i BE (Belgia), NL (Nederland), BG (Bulgaria), NO (Norge).

#### Informasjon om dataene:

Begge datasettene er hentet fra Eurostat.

BNP-datasettet (nama_10r_3gdp) er en del av Regional Economic Accounts og viser verdien av bruttonasjonalprodukt for de relevante europeiske regionene. Tallene er målt i millioner euro (MIO_EUR), rapporteres årlig (freq = "A") på NUTS3-nivå, og dekker perioden 2000–2023. Datasettet inneholder fem variabler: freq, unit, geo, TIME_PERIOD og values. Variablen geo representerer regionkoder, TIME_PERIOD viser år, og values gir BNP-verdi i millioner euro. Dataene rapporteres av nasjonale statistiske institutter og samles inn og standardiseres i Eurostat.

Papulation (demo_r_pjanaggr3) kommer fra Eurostats Demography Database og viser befolkningen per 1. januar hvert år. Tallene måles i antall personer (NR) og er tilgjengelige etter kjønn og alder, men her brukes bare total befolkning (kjønn = "T", alder = "TOTAL"). Datasettet inneholder variablene freq, unit, sex, age, geo, TIME_PERIOD og values, der values viser antall personer i hver region og år.

Begge datasettene oppdateres årlig, dekker europeiske land, og gir et felles grunnlag for å beregne BNP per innbygger og analysere regionale forskjeller i Belgia (BE), Nederland (NL), Bulgaria (BG) og Norge (NO).

### Beregning av BNP per innbygger

#### Merger og rydder datasetter GDP og papulation

```{r}
# merger datasetter GDP og papulation
gdp_pop <- left_join(
  gdp,
  population,
  by = join_by(geo, TIME_PERIOD),
  suffix = c("_gdp", "_pop"))

# Teller antall manglende verdier (NA) i hver variabel
colSums(is.na(gdp_pop))
# Viser totalt antall manglende verdier i hele datasettet
sum(is.na(gdp_pop))
# Dette steget brukes for å sjekke om datasettet har manglende verdier. De to metodene viser det samme resultatet – 2 310 manglende verdier i datasettet etter merged.

# fjerner manglende verdier, og beregner BNP per innbygger
gdp_pop <- gdp_pop %>%
  drop_na(values_gdp, values_pop) %>%
  mutate(GDPC = (values_gdp * 1e6) / values_pop) %>% # BNP per innbygger (GDPC) er beregnet i euro per person
  filter(values_pop > 0, is.finite(GDPC)) # Fjerner ugyldige eller ekstreme observasjoner
  
```

#### Kontrollerer datastrukturen og verdiene etter sammenslåing og beregning

```{r}
# Viser strukturen til datasettet etter beregningen
glimpse(gdp_pop)
# Oppsummerer sentrale statistiske mål for å kontrollere verdiene
summary(gdp_pop)
```

glimpse(gdp_pop) viser at datasettet inneholder 2 119 observasjoner og 11 variabler etter sammenslåing og rensing. Variablene inkluderer blant annet regionkode (geo), år (TIME_PERIOD), BNP i millioner euro (values_gdp), befolkning (values_pop) og beregnet BNP per innbygger (GDPC). summary(gdp_pop) gir et overblikk over fordelingen i dataene. Tidsperioden dekker årene 2000–2023. BNP-verdiene varierer fra om lag 168 til 103 285 millioner euro, mens befolkningen i regionene varierer fra under 42 000 til over 1,29 millioner personer. Variabelen GDPC viser de beregnede verdiene for BNP per innbygger, som danner grunnlaget for den videre analysen.

### Beskrivende analyse

#### Grunnleggende deskriptiv statistikk

```{r}
# Grunnleggende deskriptiv statistikk for merged datasettet
gdpc_summary <- gdp_pop %>%
  filter(values_pop > 0, is.finite(GDPC)) %>% 
  summarise(
    n_obs = n(),
    Min = min(GDPC, na.rm = TRUE),
    Q1  = quantile(GDPC, 0.25, na.rm = TRUE),
    Median = median(GDPC, na.rm = TRUE),
    Mean = mean(GDPC, na.rm = TRUE),
    Q3  = quantile(GDPC, 0.75, na.rm = TRUE),
    Max = max(GDPC, na.rm = TRUE),
    SD  = sd(GDPC, na.rm = TRUE)
  )
gdpc_summary

# viser den generelle fordelingen av BNP per innbygger
bnp_per_innbygger <- gdp_pop %>% 
  ggplot(aes(x = GDPC)) +
  geom_histogram(bins = 40, fill = "steelblue", color = "white") +
  labs(
    title = "Fordeling av BNP per innbygger (alle regioner)",
    x = "BNP per innbygger (euro per person)",
    y = "Antall regioner"
  )
bnp_per_innbygger
```

#### Deskriptiv statistikk for hvert land

```{r}
# Deskriptiv statistikk for hvert land
gdp_land_summary <- gdp_pop %>%
  filter(values_pop > 0, is.finite(GDPC)) %>% 
  mutate(country = substr(geo, 1, 2)) %>%
  group_by(country) %>%
  summarise(
    n_obs = n(),
    Min = min(GDPC, na.rm = TRUE),
    Q1  = quantile(GDPC, 0.25, na.rm = TRUE),
    Median = median(GDPC, na.rm = TRUE),
    Mean = mean(GDPC, na.rm = TRUE),
    Q3  = quantile(GDPC, 0.75, na.rm = TRUE),
    Max = max(GDPC, na.rm = TRUE),
    SD  = sd(GDPC, na.rm = TRUE)
  )
gdp_land_summary

# Sammenligning mellom land: boksdiagram
bnp_per_innbygger_land  <- gdp_pop %>% 
  mutate(
    land_full = recode(substr(geo, 1, 2),
                       "BE" = "Belgia",
                       "BG" = "Bulgaria",
                       "NL" = "Nederland",
                       "NO" = "Norge")
  ) %>%
  ggplot(aes(x = land_full, y = GDPC, fill = land_full)) +
  geom_boxplot() +
  labs(
    title = "BNP per innbygger etter land",
    x = "Land",
    y = "BNP per innbygger (euro)",
    fill = "Land"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )


bnp_per_innbygger_land
```

#### BNP per innbygger etter land over tid

```{r}
# Utvikling av BNP per innbygger over tid (medianverdi)
bnp_over_tid_median <- gdp_pop %>%
  mutate(land = substr(geo, 1, 2)) %>%
  group_by(land, TIME_PERIOD) %>%
  summarise(
    median_BNPI = median(GDPC, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(land_full = recode(land,
                            "BE" = "Belgia",
                            "BG" = "Bulgaria",
                            "NL" = "Nederland",
                            "NO" = "Norge")) %>%
  ggplot(aes(x = TIME_PERIOD, y = median_BNPI, color = land_full)) +
  geom_line(size = 1.2) +
  scale_y_continuous(limits = c(0, 70000),
                     labels = scales::comma) +
  labs(
    title = "Utvikling i median BNP per innbygger (2000–2023)",
    x = "År",
    y = "BNP per innbygger (euro)",
    color = "Land"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.title = element_text(face = "bold"),
    legend.position = "right"
  )
bnp_over_tid_median
```
